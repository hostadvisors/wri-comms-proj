---
import type { Props } from '@astrojs/starlight/props';
import LanguageSelect from '@astrojs/starlight/components/LanguageSelect.astro';
import Search from '@astrojs/starlight/components/Search.astro';
import SiteTitle from '@astrojs/starlight/components/SiteTitle.astro';
import SocialIcons from '@astrojs/starlight/components/SocialIcons.astro';
import ThemeSelect from '@astrojs/starlight/components/ThemeSelect.astro';

// Check if user is authenticated
const isAuthenticated = Astro.cookies.get('wri-auth')?.value === 'authenticated';
const isHomePage = Astro.url.pathname === '/';
---

<script>
// Client-side authentication check for static pages
(function() {
  // Check if we're on a protected page (not login, logout, or homepage)
  const currentPath = window.location.pathname;
  const isHomepage = currentPath === '/' || currentPath === '/index.html';
  const isAuthPage = currentPath.startsWith('/login') || currentPath.startsWith('/logout');
  
  if (isHomepage || isAuthPage) {
    return; // No auth check needed
  }
  
  // Check for authentication cookie
  function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) {
      const part = parts.pop();
      return part ? part.split(';').shift() : null;
    }
    return null;
  }
  
  const authCookie = getCookie('wri-auth');
  
  if (authCookie !== 'authenticated') {
    // Not authenticated - redirect to login with return URL
    const loginUrl = `/login?returnTo=${encodeURIComponent(currentPath)}`;
    window.location.href = loginUrl;
  }
})();
</script>

<div class="custom-header-content sl-flex">
	<div class="sl-flex site-title-area">
		<SiteTitle {...Astro.props} />
	</div>
	<div class="sl-flex content-area">
		<div class="sl-flex sl-gap-sm search-area">
			<Search {...Astro.props} />
		</div>
		<div class="sl-flex sl-gap-md controls-area">
			<SocialIcons {...Astro.props} />
			<ThemeSelect {...Astro.props} />
			<LanguageSelect {...Astro.props} />
			{isAuthenticated && !isHomePage && (
				<a href="/logout" class="logout-button sl-flex">
					<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
						<path d="M17 8l4 4-4 4-1.41-1.41L17.17 13H9v-2h8.17l-1.58-1.59L17 8zM5 5h7V3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h7v-2H5V5z"/>
					</svg>
				</a>
			)}
		</div>
	</div>
</div>



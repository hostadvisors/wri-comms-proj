---
import type { Props } from '@astrojs/starlight/props';
import LanguageSelect from '@astrojs/starlight/components/LanguageSelect.astro';
import Search from '@astrojs/starlight/components/Search.astro';
import SiteTitle from '@astrojs/starlight/components/SiteTitle.astro';
import SocialIcons from '@astrojs/starlight/components/SocialIcons.astro';
import ThemeSelect from '@astrojs/starlight/components/ThemeSelect.astro';

// Check if user is authenticated
const isAuthenticated = Astro.cookies.get('wri-auth')?.value === 'authenticated';
const isHomePage = Astro.url.pathname === '/';
---

<div class="custom-header-content sl-flex">
	<div class="sl-flex site-title-area">
		<SiteTitle {...Astro.props} />
	</div>
	<div class="sl-flex content-area">
		<div class="sl-flex sl-gap-sm search-area">
			<Search {...Astro.props} />
		</div>
		<div class="sl-flex sl-gap-md controls-area">
			<SocialIcons {...Astro.props} />
			<ThemeSelect {...Astro.props} />
			<LanguageSelect {...Astro.props} />
			{isAuthenticated && !isHomePage && (
				<a href="/logout" class="logout-button sl-flex">
					<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
						<path d="M17 8l4 4-4 4-1.41-1.41L17.17 13H9v-2h8.17l-1.58-1.59L17 8zM5 5h7V3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h7v-2H5V5z"/>
					</svg>
				</a>
			)}
		</div>
	</div>
</div>

<style>
	.custom-header-content {
		gap: var(--sl-nav-gap);
		align-items: center;
		width: 100%;
	}

	.site-title-area {
		/* Match the sidebar width */
		width: var(--sl-sidebar-width, 18.5rem);
		min-width: var(--sl-sidebar-width, 18.5rem);
		max-width: var(--sl-sidebar-width, 18.5rem);
		flex-shrink: 0;
	}

	.content-area {
		/* Fill remaining space */
		flex: 1;
		justify-content: space-between;
		align-items: center;
		gap: var(--sl-nav-gap);
	}

	.search-area {
		/* Search stays left-aligned with fixed width */
		justify-content: flex-start;
		flex: 0 0 auto;
		width: var(--sl-sidebar-width, 18.5rem);
		min-width: var(--sl-sidebar-width, 18.5rem);
		max-width: var(--sl-sidebar-width, 18.5rem);
	}

	/* Target the actual search input inside the search component */
	.search-area :global(input[type="search"]) {
		width: 100% !important;
		max-width: 100% !important;
	}

	.search-area :global(.search-input) {
		width: 100% !important;
		max-width: 100% !important;
	}

	.controls-area {
		/* Controls stay right-aligned */
		justify-content: flex-end;
		flex: 0 0 auto;
	}

	/* On mobile, let it be flexible */
	@media (max-width: 50rem) {
		.site-title-area {
			width: auto;
			min-width: auto;
			max-width: none;
			flex-shrink: 1;
		}

		.search-area {
			display: none; /* Hide search on mobile */
		}
	}

	/* Tablet size - reduce search width */
	@media (max-width: 768px) and (min-width: 50rem) {
		.search-area {
			width: 150px;
			max-width: 150px;
		}
	}

	/* Small desktop - slightly smaller search */
	@media (max-width: 1024px) and (min-width: 768px) {
		.search-area {
			width: 180px;
			max-width: 180px;
		}
	}

	.logout-button {
		align-items: center;
		gap: 0.25rem;
		color: var(--sl-color-gray-1);
		border: 1px solid var(--sl-color-gray-5);
		background-color: var(--sl-color-gray-6);
		border-radius: 0.5rem;
		padding: 0.5rem 0.75rem;
		text-decoration: none;
		font-size: var(--sl-text-xs);
		line-height: 1;
		transition: border-color 0.2s, background-color 0.2s;
	}	.logout-button:hover {
		background-color: var(--wri-gold-bg);
		border-color: var(--wri-gold-bg);
		color: white;
	}

	.logout-button svg {
		width: 1rem;
		height: 1rem;
	}

	/* On mobile, make it more visible */
	@media (max-width: 50rem) {
		.logout-button {
			background-color: var(--wri-gold-bg);
			border-color: var(--wri-gold-bg);
			color: white;
		}
		
		.logout-button:hover {
			background-color: var(--wri-gold-accessible);
			border-color: var(--wri-gold-accessible);
		}
	}
</style>
